#!/usr/bin/env bash
set -e

# GitHub CLI Extension: gh-unpushed
# Shows unpushed commits for the current branch compared to a remote (default: origin)

if [[ "$1" == "--help" || "$1" == "-h" ]]; then
  echo "Usage: gh unpushed [remote]"
  echo "Shows unpushed commits for the current Git branch compared to the specified remote (default: origin)."
  exit 0
fi

remote=${1:-origin}
branch=$(git branch --show-current)

if [[ -z "$branch" ]]; then
  echo "ðŸš« Not currently on a branch."
  exit 1
fi

if ! git rev-parse --verify "$remote/$branch" &> /dev/null; then
  echo "ðŸš« Remote branch '$remote/$branch' doesn't exist!"
  exit 1
fi

unpushed=$(git log "$remote/$branch"..HEAD \
  --pretty=format:"â€¢ %C(yellow)%h%Creset  %Cgreen%ad%Creset  %s" \
  --date=format:'%Y-%m-%d %H:%M:%S')

if [[ -z "$unpushed" ]]; then
  echo "âœ… No unpushed commits on '$branch' compared to '$remote'."
else
  echo "ðŸš€ Unpushed commits on '$branch' (not yet pushed to '$remote/$branch'):"
  echo ""
  echo "$unpushed"
  echo ""
fi
